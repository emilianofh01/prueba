<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <!-- TAB ICON -->
    <link rel="icon" href="assets/images/logo-dorado.png">
    <!-- BOOTSTRAP 5.2.3 -->
    <link rel="stylesheet" href="assets/libs/bootstrap-5.2.3/bootstrap.min.css">
    <!-- FONT AWESOME -->
    <link rel="stylesheet" href="assets/libs/fontawesome/css/all.min.css">
    <!-- MAIN CSS -->
    <link rel="stylesheet" href="assets/css/main.css">
    <!-- PWA META TAGS -->
    <meta name="theme-color" content="#1A1A1A">
    <meta name="MobileOptimized" content="width">
    <meta name="HandheldFriendly" content="true">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#1A1A1A">
    <link rel="shortcut icon" type="image/png" href="./img/64x64.png">
    <link rel="apple-touch-icon" href="../img/64x64.png">
    <link rel="apple-touch-startup-image" href="../img/64x64.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_14_Pro_Max_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_14_Pro_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_11__iPhone_XR_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_14_Pro_Max_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_14_Pro_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_11__iPhone_XR_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_portrait.png">
    <link rel="manifest" href="manifest.json">
    <style>
        .login_wrapper {
            /* --show-invitation: none; */
            position: relative;
            overflow: hidden;
        }

        .login_wrapper.open-invitation .advertisement {
            animation-name: showInvitation;
            animation-duration: 0.3s;
            animation-timing-function: ease;
            animation-delay: 0.3s;
            animation-fill-mode: both;

            transition: all ease 0.2s;
            transition-delay: 2s;
        }

        .login_wrapper.open-invitation::before {
            animation-name: showBackground;
            animation-duration: 0.2s;
            animation-timing-function: linear;
            animation-delay: 0.2s;
            animation-fill-mode: both;

            transition: all ease 0.2s;
            transition-delay: .7s;
        }

        /* CERRAR INVITACION */
        .login_wrapper.open-invitation.close-invitation .advertisement {
            animation-name: hideInvitation;
            animation-duration: 0.3s;
            animation-timing-function: ease;
            animation-fill-mode: both;
        }

        .login_wrapper.open-invitation.close-invitation::before {
            animation-name: hideBackground;
            animation-duration: 0.2s;
            animation-timing-function: linear;
            animation-fill-mode: both;

            height: 0;
        }

        .login_wrapper::before {
            content: '';
            /* display: var(--show-invitation); */
            background-color: rgba(0, 0, 0, 0);
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 1000;
        }

        .advertisement {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            width: 95%;
            background-color: #efeff1;
            overflow: hidden;
            position: fixed;
            bottom: -100%;
            border-radius: 25px;
            left: 0;
            right: 0;
            margin: auto;
            z-index: 1000;
            /* transition: all ease 0.2s; */
            /* display: var(--show-invitation); */
        }



        @keyframes showBackground {
            0% {
                display: none;
                background-color: rgba(0, 0, 0, 0);
            }

            100% {
                display: block;
                background-color: rgba(0, 0, 0, 0.5);
            }
        }

        @keyframes hideBackground {

            0% {
                display: block;
                background-color: rgba(0, 0, 0, 0.5);
            }

            100% {
                display: none;
                background-color: rgba(0, 0, 0, 0);
            }
        }

        @keyframes showInvitation {
            0% {
                display: none;
                bottom: -100%;
            }

            100% {
                display: block;
                bottom: 20px;
            }
        }

        @keyframes hideInvitation {
            0% {
                display: block;
                bottom: 20px;
            }

            100% {
                display: none;
                bottom: -100%;
            }
        }

        .advertisement .header {
            display: flex;
            align-items: center;
            padding: 20px;
            padding-bottom: 0;
        }

        .advertisement .header svg {
            width: 50px;
            height: 50px;
            background-color: white;
            padding: 12px;
            border-radius: 10px;
            margin-right: 15px;
            box-shadow: 0px 0px 3px 0px rgb(0 0 0 / 20%);
        }

        .advertisement .body {
            padding-inline: 20px;
            padding-bottom: 20px;
        }

        .advertisement hr {
            margin-block: 15px;
            color: #929292;
        }

        .advertisement .header h2 {
            margin-bottom: 0;
            font-size: 1.4em;
            /* font-weight: bold; */
        }

        .advertisement button path {
            fill: #7e7e7e;
        }

        .advertisement .body button {
            background-color: #007aff;
            color: white;
            width: 100%;
            padding: 15px 20px;
            border-radius: 10px;
        }

        .advertisement>button {
            position: absolute;
            width: 50px;
            height: 50px;
            padding: 16px;
            display: flex;
            justify-content: center;
            align-items: center;

            right: 20px;
            bottom: 20px;
            border-radius: 50%;
            background-color: white;
            box-shadow: 0px 0px 3px 0px rgb(0 0 0 / 20%);
        }

        .advertisement_instructions li img {
            width: 28px;
            background-color: white;
            padding: 3px 6px;
            border-radius: 5px;
            margin-left: 5px;
            box-shadow: 0px 0px 3px 0px rgb(0 0 0 / 20%);
        }

        .advertisement_instructions {
            padding-left: 0;
            list-style-position: inside;
        }

        .advertisement_instructions li {
            margin-bottom: 20px;
        }

        .advertisement_instructions li b {
            background-color: white;
            padding: 5px;
            border-radius: 5px;
            box-shadow: 0px 0px 3px 0px rgb(0 0 0 / 20%);
        }
    </style>
</head>

<body>
    <div id="app" v-cloak>
        <div class="login_wrapper" :class="`${installed ? 'close-invitation' : 'open-invitation'}`">
            <div class="login-background">
                <div class="login-background-overlay d-flex flex-column justify-content-center align-items-center">
                    <div class="login p-4">
                        <img src="assets/images/logo-blanco.png" class="p-2 mb-5" alt="">

                        <div class="d-flex flex-column justify-content-center">
                            <!-- EMAIL INPUT -->
                            <div class="login-inputs">
                                <label for="email" class="mb-2">Correo electrónico:</label>
                                <div>
                                    <input type="email" name="email" class="input-next-icon mb-2"
                                        placeholder="Ingresa tu correo" v-model="email">
                                    <span><i class="fa-solid fa-envelope"></i></span>
                                </div>
                            </div>
                            <!-- PASSWORD INPUT -->
                            <div class="login-inputs">
                                <label for="password" class="mb-2">Contraseña:</label>
                                <div>
                                    <input type="password" id="password" name="password" class="input-next-icon mb-2"
                                        placeholder="Ingresa tu contraseña" v-model="password">
                                    <button type="button"><i class="fa-solid fa-eye-slash"
                                            id="togglePassword"></i></button>
                                </div>
                            </div>
                            <!-- RECOVER PASSWORD LINK -->
                            <a href="views/recover-password.html" class="text-end mb-4">
                                ¿Olvidó su contraseña?
                            </a>
                            <!-- BUTTON SUBMIT AND REGISTER LINK -->
                            <div class="login-buttons-actions mt-4">
                                <button type="submit" class="mb-3 bgcolor-primary" @click="login">
                                    Comenzar
                                </button>
                                <a href="views/register.html" class="mb-4">
                                    ¿No tienes una cuenta? <span class="ms-2 txtcolor-primary">Registrate</span>
                                </a>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            <div class="advertisement">
                <div class="header">
                    <svg xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 576 512"><!--! Font Awesome Pro 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. -->
                        <path
                            d="M264.5 5.2c14.9-6.9 32.1-6.9 47 0l218.6 101c8.5 3.9 13.9 12.4 13.9 21.8s-5.4 17.9-13.9 21.8l-218.6 101c-14.9 6.9-32.1 6.9-47 0L45.9 149.8C37.4 145.8 32 137.3 32 128s5.4-17.9 13.9-21.8L264.5 5.2zM476.9 209.6l53.2 24.6c8.5 3.9 13.9 12.4 13.9 21.8s-5.4 17.9-13.9 21.8l-218.6 101c-14.9 6.9-32.1 6.9-47 0L45.9 277.8C37.4 273.8 32 265.3 32 256s5.4-17.9 13.9-21.8l53.2-24.6 152 70.2c23.4 10.8 50.4 10.8 73.8 0l152-70.2zm-152 198.2l152-70.2 53.2 24.6c8.5 3.9 13.9 12.4 13.9 21.8s-5.4 17.9-13.9 21.8l-218.6 101c-14.9 6.9-32.1 6.9-47 0L45.9 405.8C37.4 401.8 32 393.3 32 384s5.4-17.9 13.9-21.8l53.2-24.6 152 70.2c23.4 10.8 50.4 10.8 73.8 0z" />
                    </svg>

                    <h2>Instalar RBE</h2>
                </div>
                <hr>
                <div class="body">
                    <p>Instale la aplicación para acceder facilmente a ella en cualquier momento. Sin tienda de
                        aplicaciones
                        ni descargas, y mucho menos complicaciones.</p>

                    <ol v-if="platform == 'ios'" class="advertisement_instructions">
                        <li>Presione en <img src="./img/apple_share_icon.jpg" alt=""></li>
                        <li>Seleccione <b>Agregar a Inicio</b></li>
                    </ol>

                    <button v-if="platform == 'android' || platform == 'unknown'" @click="installApp">
                        Instalar
                    </button>
                </div>
                <button @click="hideInvitation">
                    <img src="./img/close_icon.svg" alt="">
                </button>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script src="script.js"></script>
    <script src="sw.js"></script>
    <script src="assets/libs/bootstrap-5.2.3/bootstrap.min.js"></script>
    <script src="assets/js/jquery-3.6.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
    <!-- Enlazar vuejs -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
        const { createApp } = Vue
        const data = null;
        const error = null;
        createApp({
            data() {
                return {
                    email: '',
                    password: '',
                    userType: 'User',
                    platform: "",
                    installed: '',

                    tmp_user: []
                }
            },
            methods: {
                async loadNotifications({ token = String }) {
                    let { data: res } = await axios({
                        method: 'GET',
                        url: 'https://rv.devcobaja.com/api/notifications',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                        },
                    })

                    let { data } = res;
                    let { length } = data.filter(e => !e.pivot.seen);

                    return {
                        last_request_date: Date.now(),
                        pending_notifications: length
                    }
                },
                detectPlatform() {
                    const UA = navigator.userAgent;

                    const IOS = UA.match(/iPhone|iPad|iPod/);
                    const ANDROID = UA.match(/Android/);


                    const standalone = window.matchMedia('(display-mode: standalone)').matches;

                    this.installed = !!(standalone || (IOS && !UA.match(/Safari/)));
                    this.platform = IOS ? 'ios' : ANDROID ? 'android' : 'unknown';

                    // alert(`instalado: ${this.installed}, plataforma: ${this.platform}`)
                },
                hideInvitation(event) {
                    let loginWrapper = document.querySelector('.login_wrapper');
                    loginWrapper.classList.add('close-invitation');

                },
                async login(e) {
                    e.preventDefault();
                    var data = new FormData();
                    data.append('email', this.email);
                    data.append('password', this.password);
                    data.append('user_type', this.userType);

                    var config = {
                        method: 'post',
                        url: 'https://rv.devcobaja.com/api/login',
                        data: data
                    };

                    axios(config)
                        .then(async ({ data }) => {
                            let user_info = data.data;

                            if (data.code == 200) {
                                let { id, email, name, lastname, phone_number, token, about, profile_photo_url } = user_info;

                                let tmp_user = {
                                    id,
                                    email,
                                    name,
                                    lastname,
                                    phone_number,
                                    token,
                                    about,
                                    profile_photo_url,
                                    notifications: {},
                                    urlAvatar: ""
                                }

                                const urlParam = new URLSearchParams(tmp_user.name).toString();

                                tmp_user['notifications'] = await this.loadNotifications({ token: token });
                                tmp_user['urlAvatar'] = `https://ui-avatars.com/api/?name=${urlParam}&background=1d1818&color=d9ac6c&size=128`


                                window.localStorage.setItem('usuario', JSON.stringify(tmp_user));
                                console.log(JSON.parse(window.localStorage.getItem('usuario')))

                                window.location.href = "./views/homepage.html";
                            }
                        })
                        .catch((error) => {
                            console.log(error)
                            alert("Datos erroneos")
                        });
                },
                installApp() {
                    window.deferredPrompt.prompt()
                },
                async verifyAccount({ token = String }) {
                    return await axios({
                        method: 'post',
                        url: 'https://rv.devcobaja.com/api/update-info',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                        }
                    })
                }
            },
            async mounted() {
                let user = window.localStorage.usuario;
                if (user) {
                    user = JSON.parse(user);
                    if (!window.navigator.onLine && user.token) window.location.href = "./views/homepage.html";

                    let { status } = await this.verifyAccount({ token: user.token });
                    console.log(status);
                    if (status == 200) {
                        window.location.href = "./views/homepage.html"
                    }

                }
                this.detectPlatform();
            }

        }).mount('#app')
    </script>
    <script src="assets/js/toggle-password.js"></script>

</body>

</html>