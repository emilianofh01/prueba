<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario</title>
    <!-- TAB ICON -->
    <link rel="icon" href="../assets/images/logo-dorado.png">
    <!-- BOOTSTRAP 5.2.3 -->
    <link rel="stylesheet" href="../assets/libs/bootstrap-5.2.3/bootstrap.min.css">
    <!-- FONT AWESOME -->
    <link rel="stylesheet" href="../assets/libs/fontawesome/css/all.min.css">
    <!-- MAIN CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <!-- PWA META TAGS -->
    <meta name="theme-color" content="#1A1A1A">
    <meta name="MobileOptimized" content="width">
    <meta name="HandheldFriendly" content="true">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#1A1A1A">
    <!-- <link rel="shortcut icon" type="image/png" href="../img/64x64.png"> -->
    <!-- <link rel="apple-touch-icon" href="../img/"> -->
    <!-- <link rel="apple-touch-startup-image" href="../img/64x64.png"> -->
    <link rel="apple-touch-icon" href="../img/64x64.png">
    <link rel="apple-touch-startup-image" href="../img/64x64.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="../img/splash_iOS/splash_screens/iPhone_14_Pro_Max_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="../img/splash_iOS/splash_screens/iPhone_14_Pro_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="../img/splash_iOS/splash_screens/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="../img/splash_iOS/splash_screens/iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="../img/splash_iOS/splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="../img/splash_iOS/splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="../img/splash_iOS/splash_screens/iPhone_11__iPhone_XR_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)" href="../img/splash_iOS/splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="../img/splash_iOS/splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)" href="../img/splash_iOS/splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_landscape.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="../img/splash_iOS/splash_screens/iPhone_14_Pro_Max_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="../img/splash_iOS/splash_screens/iPhone_14_Pro_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="../img/splash_iOS/splash_screens/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="../img/splash_iOS/splash_screens/iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="../img/splash_iOS/splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="../img/splash_iOS/splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="../img/splash_iOS/splash_screens/iPhone_11__iPhone_XR_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" href="../img/splash_iOS/splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="../img/splash_iOS/splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_portrait.png">
    <link rel="apple-touch-startup-image" media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" href="../img/splash_iOS/splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_portrait.png">
    <link rel="manifest" href="../manifest.json">
    <style>
        #calendar {
            border-spacing: 0;
            border-collapse: separate;
        }

        .scheduled-day.selected {
            /* color: white; */
            border: 2px solid transparent;
        }

        .scheduled-day.selected::after {
            width: 38px !important;
            height: 38px !important;
            margin: 0 auto !important;
            top: 50% !important;
            background-color: transparent;
            border: 2px solid var(--primary-color);
        }

        td {
            border: 1px solid transparent;
        }
    </style>
</head>

<body>
    <div id="app" v-cloak>

        <!-- HEADER WITH LOGO AND TITLE -->
        <header id="header" class="header-logo-title p-1">
            <div class="header-logo">
                <img src="../assets/images/logo-dorado-margen.png" alt="">
            </div>
            <div class="header-title">
                <h2 class="text-center fs-24 fw-700 txtcolor-primary m-0">Calendario</h2>
            </div>
            <div class="header-account me-2">
                <a href="profile.html" class="d-flex justify-content-center align-items-center position-relative">
                    <img style="overflow: hidden;" :src="`${datos.profile_photo_url ?? datos.userNameURL}`"
                        @error="profileImageError" alt="">
                    <span v-if="datos.notifications.pending_notifications"
                        class="position-absolute translate-middle badge rounded-pill fw-700 fs-10 bgcolor-primary txtcolor-black">
                        {{datos.notifications.pending_notifications}}
                    </span>
                </a>
            </div>
        </header>

        <!-- MAIN CONTENT -->
        <main class="container-fluid p-0">
            <!-- SEARCH BAR -->
            <div class="search-bar search-bar-alt p-4">
                <form action="" method="" class="d-flex">
                    <button type="submit">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </button>
                    <input @input="applyFilter" type="text" name="" class="px-1" placeholder="Buscar cita">
                </form>
            </div><!-- end search bar -->

            <!-- CALENDAR -->
            <div class="px-4 mb-4" :style="`display: ${!filter.trim() ? 'block' : 'none'}`">
                <div class="row">
                    <div class="col-md-12 ff-raleway">
                        <div class="elegant-calendar d-md-flex">
                            <div class="wrap-header d-flex align-items-center">
                                <p id="reset" class="d-none">reset</p>
                                <div id="headerCalendar" class="p-0">
                                    <div @click="preMonth"
                                        class="pre-button d-flex align-items-center justify-content-center"><i
                                            class="fa fa-chevron-left"></i></div>
                                    <div class="head-info">
                                        <div class="head-day"></div>
                                        <div class="head-month"></div>
                                    </div>
                                    <div @click="nextMonth"
                                        class="next-button d-flex align-items-center justify-content-center"><i
                                            class="fa fa-chevron-right"></i></div>
                                </div>
                            </div>
                            <div class="calendar-wrap">
                                <!-- 
                                    NOTA: 
                                    - PARA PODER MODIFICAR LOS DÍAS MARCADOS AL CAMBIAR DE MES ES NECESARIO MODIFICAR EL JS
                                    - LA CLASE PARA MARCAR EL DÍA CON CITAS ES: .scheduled-day
                                 -->
                                <table id="calendar">
                                    <thead>
                                        <tr class="calendar-headers">
                                            <th>Dom</th>
                                            <th>Lun</th>
                                            <th>Mar</th>
                                            <th>Mie</th>
                                            <th>Jue</th>
                                            <th>Vie</th>
                                            <th>Sab</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="i in 6">
                                            <td @click="selectDay" v-for="j in 7"></td>
                                        </tr>

                                    </tbody>
                                </table>
                            </div><!-- end calendar wrap -->
                        </div><!-- end elegant calendar -->
                    </div><!-- end col -->
                </div><!-- end row -->
            </div><!-- end div calendar -->

            <!-- NEXT DATES (APPOINTMENTS) -->
            <div class="px-4 pt-3 pb-4">
                <div class="row">
                    <h2 class="ff-raleway fs-24 fw-700 mb-3">Próximas citas</h2>
                    <!-- CARD DATE -->
                    <div class="col-12 col-md-6 col-lg-4 col-xl-4 col-xxl-3 mb-3" v-for="event in filterEvents()">
                        <div class="card-date p-3">
                            <div class="d-flex w-100 mb-2">
                                <div class="card-date-content">
                                    <h1 class="fs-18 fw-700 text-center">{{event.title}}</h1>
                                    <div class="d-flex mb-1" v-if="event.clients.length">
                                        <label>Cliente:</label>
                                        <h2 class="fst-italic fs-14 fw-400 m-0">{{event.clients[0].name}}</h2>
                                    </div>
                                    <div class="d-flex mb-1">
                                        <label>Fecha:</label>
                                        <h2 class="fst-normal fs-14 fw-400 m-0"
                                            v-html="getFormatDate({date: event.start})"></h2>
                                    </div>
                                    <div class="d-flex">
                                        <label>Hora:</label>
                                        <h2 class="fst-normal fs-14 fw-700 m-0"
                                            v-html="getFormatTime({date: event.start})"></h2>
                                    </div>
                                </div>
                                <div class="card-date-preview ms-2">
                                    <img src="../assets/images/home-demo1.png" alt="">
                                </div>
                            </div>
                            <div class="card-date-buttons w-100 pt-1">
                                <div class="card-date-btn-details">
                                    <a href="schedule-details.html" class="fs-14 fw-700">Detalles</a>
                                </div>
                                <div class="card-date-btn-contact">
                                    <a
                                        href="https://www.google.com/maps/search/?api=1&query=24.16122423600197,-110.31834537020787"><i
                                            class="fa-solid fa-location-dot"></i></a>
                                    <a href="tel:526123480678"><i class="fa-solid fa-phone"></i></a>
                                    <a href="sms:526123480678"><i class="fa-solid fa-comment-dots"></i></a>
                                </div>
                            </div>
                        </div><!-- end card date -->
                    </div><!-- end col card date -->

                </div><!-- end row -->
            </div><!-- end div next dates (appointments)  -->

            <!-- ADD BUTTON -->
            <a href="schedule-add.html" class="add-button box-shadow-25">
                <i class="fa-solid fa-plus"></i>
            </a>
        </main>

        <!-- NAVBAR -->
        <footer id="navbar">
            <!-- NOTIFICATIONS -->
            <a href="notifications.html">
                <img src="../assets/images/navbar-blanco-notificaciones.png" alt="">
            </a>
            <!-- CONTACTS -->
            <a href="contacts.html">
                <img src="../assets/images/navbar-blanco-contactos.png" alt="">
            </a>
            <!-- HOME -->
            <a href="homepage.html">
                <img src="../assets/images/navbar-blanco-inicio.png" alt="">
            </a>
            <!-- CALENDAR -->
            <a href="calendar.html">
                <img src="../assets/images/navbar-dorado-calendario.png" alt="">
            </a>
            <!-- PROFILE -->
            <a href="profile.html">
                <img src="../assets/images/navbar-blanco-perfil.png" alt="">
            </a>
        </footer>
    </div>

    <!-- JAVASCRIPT -->
    <!-- Service worker PWA -->
    <!-- <script src="../sw.js"></script> -->
    <script src="../script.js"></script>
    <script src="../assets/libs/bootstrap-5.2.3/bootstrap.min.js"></script>
    <script src="../assets/js/jquery-3.6.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>

    <script src="../assets/libs/bootstrap-calendar/js/main.js"></script>
    <script src="../assets/libs/bootstrap-calendar/js/popper.js"></script>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        const { createApp } = Vue
        const data = null;
        const error = null;
        // e.name.toUpperCase().includes('ga'.toUpperCase()))
        createApp({
            data() {
                return {
                    datos: JSON.parse(window.localStorage.usuario),
                    events: [],
                    filter: "",
                    calendar: null,
                    focusDate: ""
                }
            },
            methods: {
                profileImageError(event) {
                    event.target.src = this.datos.urlAvatar;
                },
                getConfig({ url = String, data = FormData, method = String }) {
                    return {
                        method: method,
                        url: url,
                        data: data,
                        headers: {
                            'Authorization': `Bearer ${this.datos.token}`,
                        },
                    };
                },
                async loadEvents() {
                    let { data: res } = await axios({
                        method: 'GET',
                        url: 'https://rv.devcobaja.com/api/events',
                        headers: {
                            'Authorization': `Bearer ${this.datos.token}`,
                        }
                    })
                    this.events = res.data
                    console.log(this.events);
                },
                preMonth() {
                    if (!this.calendar) return;

                    this.calendar.preMonth();
                    this.resetCalendar();
                    this.updateDateState();
                },
                nextMonth() {
                    if (!this.calendar) return;

                    this.calendar.nextMonth();
                    this.resetCalendar();
                    this.updateDateState();
                },
                updateDateState() {
                    let date = new Date();
                    let selectedDay = document.querySelector(".selected");

                    let day = selectedDay ? String(selectedDay.innerHTML).padStart(2,0) : '',
                        month = String(this.calendar.month + 1).padStart(2, '0'),
                        year = this.calendar.year;

                    this.focusDate = `${year}-${month}-${day}`;
                },
                filterEvents() {
                    if (this.filter.trim())
                        return this.events.filter(event => event.title.toLowerCase().includes(this.filter.trim().toLowerCase()));

                    let filtered = this.events.filter(event => event.start.includes(this.focusDate))
                    let days = document.querySelectorAll('td:not(#disabled)')

                    filtered.map((event) => {
                        let date = new Date(event.start);

                        Array.from(days)[date.getDate() - 1].classList.add('scheduled-day');
                        Array.from(days)[date.getDate() - 1].onclick = this.updateDateState();
                    })
                    console.log(filtered);
                    return filtered;
                },
                resetCalendar() {
                    let days = document.querySelectorAll('td')
                    Array.from(days).map(day => day.className = '');
                },
                selectDay(o) {
                    if (o.target.classList.contains('selected')) {
                        o.target.classList.remove('selected')
                        this.filterEvents();
                        return;
                    }
                    if (o.target.classList.contains('scheduled-day')) {
                        let days = document.querySelectorAll('td:not(#disabled)')

                        Array.from(days).map(day => day.classList.remove('selected'))
                        if (!o.target.classList.contains('selected')) {
                            o.target.classList.add('selected')
                        };

                        this.filterEvents()
                        return;
                    }
                },
                getFormatTime({ date = String }) {
                    let fullDate = new Date(date);
                    let hours = (fullDate.getHours() + 11) % 12 + 1;
                    let minutes = String(fullDate.getMinutes()).padStart(2, '0');
                    let amPm = fullDate.getHours() > 12 ? 'PM' : 'AM';
                    return `${hours}:${minutes} ${amPm}`
                },
                getFormatDate({ date = String }) {
                    let fullDate = new Date(date);

                    let formatDate = {
                        day: String(fullDate.getDate()).padStart(2, '0'),
                        month: String(fullDate.getMonth() + 1).padStart(2, '0'),
                        year: fullDate.getFullYear()
                    }
                    return `${formatDate.day}/${formatDate.month}/${formatDate.year}`;
                },
                applyFilter(event) {
                    this.filter = event.target.value;
                    this.resetCalendar()
                }
            },
            mounted() {
                this.calendar = new Calendar();
                this.updateDateState();
                this.loadEvents();
            },
            updated() {
            
            }
        }).mount('#app')
    </script>
</body>

</html>