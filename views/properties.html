<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Propiedades</title>
    <!-- TAB ICON -->
    <link rel="icon" href="../assets/images/logo-dorado.png">
    <!-- BOOTSTRAP 5.2.3 -->
    <link rel="stylesheet" href="../assets/libs/bootstrap-5.2.3/bootstrap.min.css">
    <!-- FONT AWESOME -->
    <link rel="stylesheet" href="../assets/libs/fontawesome/css/all.min.css">
    <!-- MAIN CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <!-- PWA META TAGS -->
    <meta name="theme-color" content="#1A1A1A">
    <meta name="MobileOptimized" content="width">
    <meta name="HandheldFriendly" content="true">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#1A1A1A">
    <link rel="shortcut icon" type="image/png" href="../img/64x64.png">
    <link rel="apple-touch-icon" href="../img/64x64.png">
    <link rel="apple-touch-startup-image" href="../img/64x64.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_14_Pro_Max_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_14_Pro_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_11__iPhone_XR_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
        href="../img/splash_iOS/splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_landscape.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_14_Pro_Max_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_14_Pro_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_11__iPhone_XR_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_portrait.png">
    <link rel="apple-touch-startup-image"
        media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
        href="../img/splash_iOS/splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_portrait.png">
    <link rel="manifest" href="../manifest.json">
</head>

<body>
    <div id="app" v-cloak>
        <!-- HEADER WITH LOGO AND TITLE -->
        <header id="header" class="header-logo-title p-1">
            <div class="header-logo">
                <img src="../assets/images/logo-dorado-margen.png" alt="">
            </div>
            <div class="header-title">
                <h2 class="text-center fs-22 fw-700 m-0">Propiedades</h2>
            </div>
            <div class="header-account me-2">
                <a href="profile.html" class="d-flex justify-content-center align-items-center position-relative">
                    <img style="overflow: hidden;" :src="`${datos.profile_photo_url ?? datos.userNameURL}`"
                        @error="profileImageError" alt="">
                    <span v-if="datos.notifications.pending_notifications"
                        class="position-absolute translate-middle badge rounded-pill fw-700 fs-10 bgcolor-primary txtcolor-black">
                        {{datos.notifications.pending_notifications}}
                    </span>
                </a>
            </div>
        </header>

        <!-- MAIN CONTENT -->
        <div>

            <main class="container-fluid p-0">
                <!-- SEARCH BAR -->
                <div class="search-bar p-4">
                    <form action="" method="" class="d-flex">
                        <button type="submit">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                        <input @input="typeFilter" type="text" name="" class="px-1" placeholder="Buscar propiedad">
                    </form>
                    <button type="button" onclick="" class="search-bar-filter">
                        <img src="../assets/images/icono-filtros.png" alt="">
                    </button>
                </div><!-- end search bar -->
                <!-- LIST PROPERTIES -->
                <div class="list-properties px-4 py-2">
                    <div class="row">
                        <!-- BIG CARD -->
                        <div class="card-home-big col-12 col-xs-6 col-sm-6 col-md-4 col-lg-3 mb-4">

                            <div class="rounded-4 box-shadow-25 mb-4" v-for="(propertie, index) in filterProperties()">
                                <div class="card-home-big-preview">
                                    <img :src="`${propertie.images[0].full_path}`" alt="">
                                    <div class="card-home-big-extras">
                                        <span class="badge-label badge-label-primary">
                                            <!-- {{prop.status === 'activo' ?
                                            'Disponible' : 'No Disponible' }}  -->
                                            {{propertie.status[0].toUpperCase() + propertie.status.slice(1) }}
                                        </span>
                                        <button @click="giveLove({index: `${index}`})" type="button"
                                            class="heart-toggle heart-toggle-transparent me-2">
                                            <i :class="`${propertie.love == true ? 'fas' : ''} far fa-heart`"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-home-big-description px-2">
                                    <div class="d-flex justify-content-between py-2 mb-1">
                                        <h2 class="ff-raleway fs-18 fw-700 m-0">
                                            {{propertie.name}}
                                        </h2>
                                        <!-- <div class="card-home-features ms-2">
                                            <i class="fa-solid fa-bed"></i>
                                            <h4 class="ff-roboto fs-16 fw-700 txtcolor-black mx-2 my-0">4</h4>
                                            <i class="fa-solid fa-bath"></i>
                                            <h4 class="ff-roboto fs-16 fw-700 txtcolor-black mx-2 my-0">3</h4>
                                            <i class="fa-solid fa-car"></i>
                                            <h4 class="ff-roboto fs-16 fw-700 txtcolor-black mx-2 my-0">2</h4>
                                        </div> -->
                                    </div>
                                    <div class="d-flex w-100">
                                        <i class="fa-solid fa-location-dot fs-14 me-2"></i>
                                        <h3 class="ff-raleway fs-12 fw-500 txtcolor-black m-0">
                                            {{propertie.address.street}} {{propertie.address.number}},
                                            {{propertie.address.apartment}}, {{propertie.address.postal_code}},
                                            {{propertie.address.city}},
                                            {{propertie.address.state}}, {{propertie.address.lot}},
                                            {{propertie.address.block}}
                                        </h3>
                                    </div>
                                    <div class="d-flex flex-wrap justify-content-between align-items-center py-2 mb-1">
                                        <div>
                                            <h2 class="ff-raleway fs-22 fw-700 txtcolor-primary mb-2">
                                                {{formarCurrency({currency: 'MXN', amount:
                                                propertie.prices[1].amount})}}
                                                {{propertie.prices[1].exchange.name}}
                                            </h2>
                                            <h2 class="ff-raleway fs-22 fw-700 txtcolor-primary mb-2">
                                                <!-- ${{propertie.prices[0].amount}} {{propertie.prices[0].exchange.name}} -->
                                                {{formarCurrency({currency: 'USD', amount:
                                                propertie.prices[0].amount})}}
                                                {{propertie.prices[0].exchange.name}}
                                            </h2>
                                        </div>

                                        <a :href="`property-details.html?property=${propertie.slug}`"
                                            class="bgcolor-white txtcolor-primary border-2-primary fs-14 fw-700 mx-2">Detalles</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div><!-- end row -->
                </div><!-- end div list properties -->
                <!-- ADD BUTTON -->
                <a href="property-add.html" class="add-button box-shadow-25">
                    <i class="fa-solid fa-plus"></i>
                </a>
            </main>
        </div>
    </div>

    <!-- NAVBAR -->
    <footer id="navbar">
        <!-- SCHEDULE -->
        <a href="notifications.html">
            <img src="../assets/images/navbar-blanco-notificaciones.png" alt="">
        </a>
        <!-- CONTACTS -->
        <a href="contacts.html">
            <img src="../assets/images/navbar-blanco-contactos.png" alt="">
        </a>
        <!-- HOME -->
        <a href="homepage.html">
            <img src="../assets/images/navbar-blanco-inicio.png" alt="">
        </a>
        <!-- CALENDAR -->
        <a href="calendar.html">
            <img src="../assets/images/navbar-blanco-calendario.png" alt="">
        </a>
        <!-- PROFILE -->
        <a href="profile.html">
            <img src="../assets/images/navbar-dorado-perfil.png" alt="">
        </a>
    </footer>

    <!-- JAVASCRIPT -->
    <!-- Service worker PWA -->
    <!-- <script src="../sw.js"></script> -->
    <script src="../script.js"></script>
    <script src="../assets/libs/bootstrap-5.2.3/bootstrap.min.js"></script>
    <script src="../assets/js/jquery-3.6.1.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Enlazar vuejs -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
        const { createApp } = Vue
        const data = null;
        const error = null;
        createApp({
            data() {
                return {
                    datos: JSON.parse(window.localStorage.getItem('usuario')),
                    properties: [],
                    filter: ""
                }
            },
            methods: {
                profileImageError(event) {
                    event.target.src = this.datos.urlAvatar;
                },
                async giveLove({ index = Number }) {
                    let form = new FormData();
                    let url = this.properties[index].love ? 'properties/remove-like' : "properties/like"
                    form.append('property_id', this.properties[index].id);

                    let { data: res } = await axios(this.getConfig({ url: url, method: 'post', data: form }))

                    if (res.code == 200) {
                        this.properties[index].love = !this.properties[index].love;
                    }
                },
                getConfig({ url = String, data = FormData, method = String }) {
                    return {
                        method: method,
                        url: `https://rv.devcobaja.com/api/${url}`,
                        data: data,
                        headers: {
                            'Authorization': `Bearer ${this.datos.token}`,
                        },
                    };
                },
                typeFilter(event) {
                    this.filter = event.target.value;
                },
                filterProperties() {
                    if (!this.filter.trim().lenght) {
                        return this.properties.filter(propertie => propertie.name.toLowerCase().includes(this.filter.trim().toLowerCase()))
                    }
                    return this.properties
                },
                formarCurrency({ currency = String, amount = Number }) {
                    const formatter = new Intl.NumberFormat('en-US', {
                        style: 'currency',
                        currency: currency,
                        currencyDisplay: "narrowSymbol"
                    })

                    return formatter.format(amount)
                },
                loadProperties() {
                    axios(this.getConfig({ method: 'get', url: 'agents/related-properties' }))
                        .then(({ data: res }) => {
                            let { data } = res;
                            console.log(data);
                            this.properties = data
                        })
                        .catch((error) => {
                            console.log(error);
                        });
                }

            },
            mounted() {
                this.loadProperties();
            }
        }).mount('#app')
    </script>
</body>

</html>